# 2025-09-30 dev log
파일 업로드 제한 값: 기본값(1MB)에서 50M(max-file-size)/100MB(max-request-size)로 증가
<br/><br/>


# 2025-10-01 Dev Log

**이슈:** RestClient(JDK HttpClient) ↔ FastAPI(uvicorn) 연동 시 빈 body 전달

---

### 🔴 문제/현상

* MVP 단계라 **`http://`** 통신 사용 중.
* ChatController → AI-API(preprocess) 호출 시 **요청 body가 비어 들어와 422 발생**.
* **Postman/Swagger-UI**로 테스트할 때는 **HTTP/1.1, HTTP/2 모두 정상 동작**.
* 그러나 Java(Spring RestClient)에서 호출할 경우, body를 담아 보냈음에도 FastAPI에서 **빈 body**로 수신됨.

---

### 🟡 원인

* **RestClient(JDK HttpClient)** 는 기본적으로 **HTTP/2 선호** → `http://` 환경에서는 **h2c 업그레이드(HTTP/1.1 → HTTP/2 전환)** 를 시도함.
* Spring 6.1+ RestClient는 **Object body 전송 시** 기본적으로 **`Transfer-Encoding: chunked`(HTTP/1.1 방식)** 로 전송함.
* **HTTP/2 자체는 문제가 아님**: Postman으로 HTTP/1.1/HTTP/2 모두 정상 확인됨.
* 문제는 **JDK HttpClient가 h2c 업그레이드 과정에서 chunked body를 보낼 때**, FastAPI 런타임(uvicorn+httptools)이 이를 **정상적으로 파싱하지 못해 body를 유실**하는 데 있음.
* 그 결과 FastAPI는 body가 없는 것처럼 인식 → **422 Unprocessable Entity** 발생.

---

### 🟢 해결 방법

1. **MVP (현재 적용)**

   * RestClient의 JDK HttpClient를 **HTTP/1.1 고정**
     <br/>→ h2c 업그레이드 자체를 막아 body 정상 수신 확인

2. **데모/실서비스 (차후 적용)**

   * **HTTPS(TLS)** 적용
   * ALPN(Application-Layer Protocol Negotiation)을 통해 **처음부터 HTTP 버전(HTTP/2 or HTTP/1.1)을 합의**
    <br/>→ h2c 업그레이드 경로가 사라져 body 유실 문제 원천 차단

